<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒè¿¹æ—¥è®° - InnerTrace-XinJiDiary</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #6a5acd;
            --secondary: #9370db;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: var(--primary);
        }
        
        .logo h1 {
            font-size: 2.8rem;
            color: var(--primary);
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .tagline {
            font-size: 1.2rem;
            color: var(--secondary);
            margin-top: 10px;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .app-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .template-selector {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        .template-selector h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .template-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .template-item {
            padding: 15px;
            border-radius: 8px;
            background: #f9f9f9;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid #eaeaea;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .template-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
            border-color: var(--secondary);
        }
        
        .template-item.active {
            border-color: var(--primary);
            background: rgba(106, 90, 205, 0.08);
        }
        
        .template-item i {
            font-size: 1.4rem;
            color: var(--primary);
        }
        
        .template-content {
            flex: 2;
            min-width: 300px;
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            position: relative;
        }
        
        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .template-title {
            color: var(--primary);
            font-size: 1.8rem;
        }
        
        .date-display {
            color: #777;
            font-size: 1rem;
        }
        
        .template-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-group label {
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-group input, 
        .form-group textarea, 
        .form-group select {
            padding: 12px 15px;
            border: 2px solid #eaeaea;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-group input:focus, 
        .form-group textarea:focus, 
        .form-group select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(147, 112, 219, 0.2);
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: flex-end;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a4ab5;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: var(--dark);
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            background: var(--success);
            color: white;
            font-weight: 500;
            box-shadow: var(--shadow);
            transform: translateX(120%);
            transition: transform 0.4s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .mood-comfort {
            background: #fff3cd;
            border-left: 4px solid var(--warning);
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-top: 5px;
            display: none;
        }
        
        .nine-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 10px;
        }
        
        .grid-item {
            aspect-ratio: 1/1;
            background: #f0f0f0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid #eaeaea;
        }
        
        .grid-item:hover {
            transform: scale(1.03);
        }
        
        .grid-item.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 8px rgba(106, 90, 205, 0.3);
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 25px 0;
            color: #777;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .logo h1 {
                font-size: 2.2rem;
            }
            
            .template-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-book-open"></i>
                <h1>å¿ƒè¿¹æ—¥è®° Â· WebDemo</h1>
            </div>
            <p class="tagline">è®°å½•è‡ªå·± Â· è§‚å¯Ÿè‡ªå·± Â· å‘ç°è‡ªå·± Â· æå‡è‡ªå·±</p>
        </header>
        
        <div class="app-container">
            <div class="template-selector">
                <h2>æ—¥è®°æ¨¡æ¿</h2>
                <div class="template-list">
                    <div class="template-item active" data-template="learning">
                        <i class="fas fa-graduation-cap"></i>
                        <div>
                            <h3>å­¦ä¹ æ¨¡æ¿</h3>
                            <p>è®°å½•æ¯æ—¥å­¦ä¹ æƒ…å†µä¸å¿ƒå¾—</p>
                        </div>
                    </div>
                    <div class="template-item" data-template="weight-loss">
                        <i class="fas fa-weight-scale"></i>
                        <div>
                            <h3>å‡è‚¥æ¨¡æ¿</h3>
                            <p>è¿½è¸ªä½“é‡å˜åŒ–ä¸å¥èº«è®¡åˆ’</p>
                        </div>
                    </div>
                    <div class="template-item" data-template="mood-healing">
                        <i class="fas fa-heart"></i>
                        <div>
                            <h3>å¿ƒæƒ…è‡ªæ„ˆæ¨¡æ¿</h3>
                            <p>ç–å¯¼æƒ…ç»ªï¼Œè‡ªæˆ‘ç–—æ„ˆ</p>
                        </div>
                    </div>
                    <div class="template-item" data-template="mood-daily">
                        <i class="fas fa-cloud-sun"></i>
                        <div>
                            <h3>21å¤©å¿ƒæƒ…è®°å½•</h3>
                            <p>è¿½è¸ªæƒ…ç»ªå˜åŒ–æ¨¡å¼</p>
                        </div>
                    </div>
                    <div class="template-item" data-template="nine-grid">
                        <i class="fas fa-th-large"></i>
                        <div>
                            <h3>ä¹å®«æ ¼å¥åº·æŒ‡å—</h3>
                            <p>æ¯æ—¥å¥åº·å°ç›®æ ‡æ‰“å¡</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="template-content">
                <div class="template-header">
                    <h2 class="template-title">å­¦ä¹ æ—¥è®°</h2>
                    <div class="date-display" id="current-date">2025å¹´6æœˆ5æ—¥ æ˜ŸæœŸä¸‰</div>
                </div>
                
                <div class="template-form" id="template-form">
                    <!-- å­¦ä¹ æ¨¡æ¿ -->
                    <div class="template" id="learning-template">
                        <div class="form-group">
                            <label for="study-content">ä»Šå¤©çš„å­¦ä¹ å†…å®¹ï¼š</label>
                            <textarea id="study-content" placeholder="è®°å½•ä»Šå¤©å­¦ä¹ äº†å“ªäº›å†…å®¹..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="study-duration">å­¦ä¹ æ—¶é•¿ï¼š</label>
                            <input type="number" id="study-duration" placeholder="è¾“å…¥å­¦ä¹ å°æ—¶æ•°">
                        </div>
                        
                        <div class="form-group">
                            <label for="study-notes">å­¦ä¹ å¿ƒå¾—ï¼š</label>
                            <textarea id="study-notes" placeholder="è®°å½•å­¦ä¹ ä¸­çš„æ„Ÿæ‚Ÿå’Œæ”¶è·..."></textarea>
                        </div>
                    </div>
                    
                    <!-- å…¶ä»–æ¨¡æ¿åœ¨JSä¸­åŠ¨æ€æ¸²æŸ“ -->
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" id="clear-btn">
                        <i class="fas fa-eraser"></i> æ¸…ç©º
                    </button>
                    <button class="btn btn-primary" id="save-btn">
                        <i class="fas fa-save"></i> ä¿å­˜æ—¥è®°
                    </button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>å¿ƒè¿¹æ—¥è®° - InnerTrace-XinJiDiary &copy; 2025 @ Morlvoid  | ç”¨å¿ƒå¯¹å¾…è‡ªå·±ï¼Œè®°å½•è‡ªå·±ï¼Œè§‚å¯Ÿè‡ªå·±ï¼Œæ³¨é‡è‡ªå·±ï¼Œè®©è‡ªå·±å˜å¾—æ›´å¥½</p>
            <p>æç¤ºï¼šæ­¤Demoç‰ˆä½¿ç”¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ï¼Œæ•°æ®ä¸ä¼šä¸Šä¼ åˆ°äº‘ç«¯</p>
        </footer>
    </div>
    
    <div class="notification" id="notification">æ—¥è®°å·²ä¿å­˜ï¼</div>
    
    <script>
        // è®¾ç½®å½“å‰æ—¥æœŸ
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        document.getElementById('current-date').textContent = now.toLocaleDateString('zh-CN', options);
        
        // æ¨¡æ¿æ•°æ®
        const templates = {
            learning: {
                title: "å­¦ä¹ æ—¥è®°",
                fields: `
                    <div class="form-group">
                        <label for="study-content">ä»Šå¤©çš„å­¦ä¹ å†…å®¹ï¼š</label>
                        <textarea id="study-content" placeholder="è®°å½•ä»Šå¤©å­¦ä¹ äº†å“ªäº›å†…å®¹..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="study-duration">å­¦ä¹ æ—¶é•¿ï¼š</label>
                        <input type="number" id="study-duration" placeholder="è¾“å…¥å­¦ä¹ å°æ—¶æ•°">
                    </div>
                    <div class="form-group">
                        <label for="study-notes">å­¦ä¹ å¿ƒå¾—ï¼š</label>
                        <textarea id="study-notes" placeholder="è®°å½•å­¦ä¹ ä¸­çš„æ„Ÿæ‚Ÿå’Œæ”¶è·..."></textarea>
                    </div>
                `
            },
            'weight-loss': {
                title: "å‡è‚¥æ—¥è®°",
                fields: `
                    <div class="form-group">
                        <label for="weight-today">ä»Šæ—¥ä½“é‡ï¼ˆkgï¼‰ï¼š</label>
                        <input type="number" step="0.1" id="weight-today" placeholder="è¾“å…¥å½“å‰ä½“é‡">
                    </div>
                    <div class="form-group">
                        <label for="food-intake">ä»Šæ—¥é¥®é£Ÿè®°å½•ï¼š</label>
                        <textarea id="food-intake" placeholder="è®°å½•ä»Šå¤©åƒäº†ä»€ä¹ˆ..."></textarea>
                        <small style="color:#777;">è‡ªåŠ¨ä¼°ç®—å¡è·¯é‡Œï¼šçº¦ 0 å¤§å¡</small>
                    </div>
                    <div class="form-group">
                        <label for="today-mood">ä»Šæ—¥å¿ƒæƒ…ï¼š</label>
                        <select id="today-mood">
                            <option value="">-- é€‰æ‹©å¿ƒæƒ… --</option>
                            <option value="happy">ğŸ˜Š å¼€å¿ƒ</option>
                            <option value="normal">ğŸ˜ ä¸€èˆ¬</option>
                            <option value="sad">ğŸ˜” ä½è½</option>
                            <option value="angry">ğŸ˜  ç”Ÿæ°”</option>
                        </select>
                        <div class="mood-comfort" id="mood-comfort">
                            <i class="fas fa-heart"></i> æ— è®ºä»Šå¤©å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæ˜å¤©éƒ½æ˜¯æ–°çš„å¼€å§‹ï¼Œè¦å¯¹è‡ªå·±æ¸©æŸ”ä¸€ç‚¹å“¦ï¼
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="exercise">ä»Šæ—¥é”»ç‚¼é¡¹ç›®ï¼š</label>
                        <input type="text" id="exercise" placeholder="ä¾‹å¦‚ï¼šè·‘æ­¥ã€ç‘œä¼½ç­‰">
                    </div>
                    <div class="form-group">
                        <label for="exercise-duration">é”»ç‚¼æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ï¼š</label>
                        <input type="number" id="exercise-duration" placeholder="è¾“å…¥é”»ç‚¼æ—¶é•¿">
                    </div>
                    <div class="form-group">
                        <label for="target-weight">æ˜å¤©ç›®æ ‡ä½“é‡ï¼ˆkgï¼‰ï¼š</label>
                        <input type="number" step="0.1" id="target-weight" placeholder="è¾“å…¥ç›®æ ‡ä½“é‡">
                    </div>
                `
            },
            'mood-healing': {
                title: "å¿ƒæƒ…è‡ªæ„ˆæ—¥è®°",
                fields: `
                    <div class="form-group">
                        <label for="angry-today">ä»Šå¤©ç”Ÿæ°”äº†å—ï¼Ÿ</label>
                        <select id="angry-today">
                            <option value="">-- é€‰æ‹© --</option>
                            <option value="yes">æ˜¯çš„ï¼Œæˆ‘ç”Ÿæ°”äº†</option>
                            <option value="no">æ²¡æœ‰ç”Ÿæ°”</option>
                        </select>
                        <div class="mood-comfort" id="anger-comfort">
                            <i class="fas fa-heart"></i> æƒ…ç»ªæ˜¯æš‚æ—¶çš„ï¼Œå®ƒä¸ä¼šå®šä¹‰ä½ ã€‚ç»™è‡ªå·±ä¸€ç‚¹æ—¶é—´å’Œç©ºé—´æ¢å¤å¹³é™ã€‚
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="anger-reason">å› ä¸ºä»€ä¹ˆäº‹æƒ…è€Œç”Ÿæ°”ï¼š</label>
                        <textarea id="anger-reason" placeholder="æè¿°è®©ä½ ç”Ÿæ°”çš„äº‹æƒ…..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="sad-reason">å› ä¸ºä»€ä¹ˆäº‹æƒ…è€Œéš¾è¿‡ï¼š</label>
                        <textarea id="sad-reason" placeholder="æè¿°è®©ä½ éš¾è¿‡çš„äº‹æƒ…..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="anger-action">ç”Ÿæ°”ååšäº†ä»€ä¹ˆï¼š</label>
                        <textarea id="anger-action" placeholder="è®°å½•ç”Ÿæ°”åçš„è¡Œä¸ºå’Œååº”..."></textarea>
                    </div>
                `
            },
            'mood-daily': {
                title: "æ¯æ—¥å¿ƒæƒ…æ—¥è®°",
                fields: `
                    <div class="form-group">
                        <label for="daily-weather">ä»Šæ—¥å¤©æ°”ï¼š</label>
                        <select id="daily-weather">
                            <option value="">-- é€‰æ‹©å¤©æ°” --</option>
                            <option value="sunny">â˜€ï¸ æ™´å¤©</option>
                            <option value="cloudy">â˜ï¸ å¤šäº‘</option>
                            <option value="rainy">ğŸŒ§ï¸ é›¨å¤©</option>
                            <option value="snowy">â„ï¸ é›ªå¤©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="daily-mood">ä»Šæ—¥å¿ƒæƒ…ï¼š</label>
                        <select id="daily-mood">
                            <option value="">-- é€‰æ‹©å¿ƒæƒ… --</option>
                            <option value="happy">ğŸ˜Š å¼€å¿ƒ</option>
                            <option value="normal">ğŸ˜ ä¸€èˆ¬</option>
                            <option value="sad">ğŸ˜” ä½è½</option>
                            <option value="angry">ğŸ˜  ç”Ÿæ°”</option>
                        </select>
                        <div class="mood-comfort" id="daily-comfort">
                            <i class="fas fa-heart"></i> è®°å½•ä¸‹ä»Šå¤©çš„å¿ƒæƒ…å§ï½
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="daily-events">ä»Šæ—¥å‘ç”Ÿäº†ä»€ä¹ˆï¼š</label>
                        <textarea id="daily-events" placeholder="è®°å½•ä»Šå¤©çš„é‡è¦äº‹ä»¶..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="mood-reason">ä»Šæ—¥å¿ƒæƒ…ä¸å¥½çš„åŸå› ï¼š</label>
                        <textarea id="mood-reason" placeholder="åˆ†æå½±å“å¿ƒæƒ…çš„åŸå› ..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="happy-action">åšäº†ä»€ä¹ˆäº‹æƒ…è®©è‡ªå·±å¼€å¿ƒï¼š</label>
                        <textarea id="happy-action" placeholder="è®°å½•è®©è‡ªå·±å¼€å¿ƒçš„äº‹æƒ…..."></textarea>
                    </div>
                `
            },
            'nine-grid': {
                title: "ä¹å®«æ ¼å¥åº·æŒ‡å—",
                fields: `
                    <div class="form-group">
                        <p>ç‚¹äº®ä½ ä»Šå¤©å®Œæˆçš„å¥åº·å°äº‹æƒ…ï¼š</p>
                        <div class="nine-grid">
                            <div class="grid-item" data-item="sun">æ™’å¤ªé˜³</div>
                            <div class="grid-item" data-item="pet">æ‘¸æ‘¸å°åŠ¨ç‰©</div>
                            <div class="grid-item" data-item="outdoor">å‡ºé—¨</div>
                            <div class="grid-item" data-item="hobby">åšå–œæ¬¢çš„äº‹</div>
                            <div class="grid-item" data-item="sleep">ä¸ç†¬å¤œ</div>
                            <div class="grid-item" data-item="praise">å¤¸å¤¸è‡ªå·±</div>
                            <div class="grid-item" data-item="water">å–ä¸¤æ¯æ°´</div>
                            <div class="grid-item" data-item="plant">çœ‹çœ‹ç»¿è‰²æ¤ç‰©</div>
                            <div class="grid-item" data-item="walk">æ•£æ­¥</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="nine-notes">ä»Šæ—¥å¥åº·æ„Ÿæ‚Ÿï¼š</label>
                        <textarea id="nine-notes" placeholder="è®°å½•ä»Šå¤©çš„å¥åº·å¿ƒå¾—..."></textarea>
                    </div>
                `
            }
        };
        
        // DOMå…ƒç´ 
        const templateItems = document.querySelectorAll('.template-item');
        const templateTitle = document.querySelector('.template-title');
        const templateForm = document.getElementById('template-form');
        const saveBtn = document.getElementById('save-btn');
        const clearBtn = document.getElementById('clear-btn');
        const notification = document.getElementById('notification');
        
        // åˆå§‹åŒ–
        let currentTemplate = 'learning';
        
        // æ¨¡æ¿åˆ‡æ¢
        templateItems.forEach(item => {
            item.addEventListener('click', () => {
                // æ›´æ–°æ´»åŠ¨çŠ¶æ€
                templateItems.forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                
                // è·å–æ¨¡æ¿ID
                currentTemplate = item.dataset.template;
                
                // æ›´æ–°æ¨¡æ¿å†…å®¹
                templateTitle.textContent = templates[currentTemplate].title;
                templateForm.innerHTML = templates[currentTemplate].fields;
                
                // åŠ è½½ä¿å­˜çš„æ•°æ®
                loadSavedData();
                
                // æ·»åŠ ç‰¹æ®Šäº‹ä»¶ç›‘å¬
                setupTemplateEvents();
            });
        });
        
        // è®¾ç½®æ¨¡æ¿ç‰¹å®šäº‹ä»¶
        function setupTemplateEvents() {
            // å¿ƒæƒ…å®‰æ…°è¯­æ˜¾ç¤ºé€»è¾‘
            if (document.getElementById('today-mood')) {
                document.getElementById('today-mood').addEventListener('change', function() {
                    const comfort = document.getElementById('mood-comfort');
                    if (this.value === 'sad' || this.value === 'angry') {
                        comfort.style.display = 'block';
                    } else {
                        comfort.style.display = 'none';
                    }
                });
            }
            
            if (document.getElementById('angry-today')) {
                document.getElementById('angry-today').addEventListener('change', function() {
                    const comfort = document.getElementById('anger-comfort');
                    if (this.value === 'yes') {
                        comfort.style.display = 'block';
                    } else {
                        comfort.style.display = 'none';
                    }
                });
            }
            
            if (document.getElementById('daily-mood')) {
                document.getElementById('daily-mood').addEventListener('change', function() {
                    const comfort = document.getElementById('daily-comfort');
                    if (this.value) {
                        comfort.style.display = 'block';
                        comfort.innerHTML = `<i class="fas fa-heart"></i> ${this.value === 'sad' || this.value === 'angry' ? 
                            'å¿ƒæƒ…ä¸å¥½ä¹Ÿæ²¡å…³ç³»ï¼Œç»™è‡ªå·±ä¸€ç‚¹æ—¶é—´å’Œç©ºé—´æ¢å¤å¹³é™ã€‚' : 
                            'è®°å½•ä¸‹ä»Šå¤©çš„å¿ƒæƒ…å§ï½'}`;
                    } else {
                        comfort.style.display = 'none';
                    }
                });
            }
            
            // ä¹å®«æ ¼ç‚¹å‡»äº‹ä»¶
            const gridItems = document.querySelectorAll('.grid-item');
            if (gridItems.length > 0) {
                gridItems.forEach(item => {
                    item.addEventListener('click', function() {
                        this.classList.toggle('active');
                    });
                });
            }
        }
        
        // ä¿å­˜æ•°æ®åˆ°localStorage
        function saveData() {
            const data = {};
            
            if (currentTemplate === 'nine-grid') {
                // å¤„ç†ä¹å®«æ ¼æ•°æ®
                const completed = [];
                document.querySelectorAll('.grid-item.active').forEach(item => {
                    completed.push(item.dataset.item);
                });
                data.completedItems = completed;
                data.notes = document.getElementById('nine-notes').value;
            } else {
                // å¤„ç†è¡¨å•æ•°æ®
                const inputs = templateForm.querySelectorAll('input, textarea, select');
                inputs.forEach(input => {
                    data[input.id] = input.value;
                });
            }
            
            localStorage.setItem(`journal_${currentTemplate}`, JSON.stringify(data));
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification('æ—¥è®°å·²ä¿å­˜ï¼');
        }
        
        // ä»localStorageåŠ è½½æ•°æ®
        function loadSavedData() {
            const savedData = localStorage.getItem(`journal_${currentTemplate}`);
            if (!savedData) return;
            
            const data = JSON.parse(savedData);
            
            if (currentTemplate === 'nine-grid') {
                // å¤„ç†ä¹å®«æ ¼æ•°æ®
                if (data.completedItems) {
                    data.completedItems.forEach(item => {
                        const el = document.querySelector(`.grid-item[data-item="${item}"]`);
                        if (el) el.classList.add('active');
                    });
                }
                if (data.notes) {
                    document.getElementById('nine-notes').value = data.notes;
                }
            } else {
                // å¤„ç†è¡¨å•æ•°æ®
                for (const key in data) {
                    const el = document.getElementById(key);
                    if (el) el.value = data[key];
                }
                
                // è§¦å‘changeäº‹ä»¶ä»¥æ˜¾ç¤ºå®‰æ…°è¯­
                if (document.getElementById('today-mood') && data['today-mood']) {
                    document.getElementById('today-mood').value = data['today-mood'];
                    document.getElementById('today-mood').dispatchEvent(new Event('change'));
                }
                
                if (document.getElementById('angry-today') && data['angry-today']) {
                    document.getElementById('angry-today').value = data['angry-today'];
                    document.getElementById('angry-today').dispatchEvent(new Event('change'));
                }
                
                if (document.getElementById('daily-mood') && data['daily-mood']) {
                    document.getElementById('daily-mood').value = data['daily-mood'];
                    document.getElementById('daily-mood').dispatchEvent(new Event('change'));
                }
            }
        }
        
        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰æ—¥è®°å†…å®¹å—ï¼Ÿ')) {
                if (currentTemplate === 'nine-grid') {
                    document.querySelectorAll('.grid-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    document.getElementById('nine-notes').value = '';
                } else {
                    const inputs = templateForm.querySelectorAll('input, textarea, select');
                    inputs.forEach(input => {
                        input.value = '';
                    });
                    
                    // éšè—å®‰æ…°è¯­
                    const comforts = document.querySelectorAll('.mood-comfort');
                    comforts.forEach(c => c.style.display = 'none');
                }
                
                // ç§»é™¤ä¿å­˜çš„æ•°æ®
                localStorage.removeItem(`journal_${currentTemplate}`);
                
                showNotification('æ—¥è®°å·²æ¸…ç©º');
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        saveBtn.addEventListener('click', saveData);
        clearBtn.addEventListener('click', clearForm);
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            loadSavedData();
            setupTemplateEvents();
            
            // ç¦»å¼€é¡µé¢æç¤º
            window.addEventListener('beforeunload', (e) => {
                // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”ç”¨ä¸­éœ€è¦æ£€æŸ¥è¡¨å•æ˜¯å¦æœ‰å†…å®¹
                e.preventDefault();
                e.returnValue = 'æ‚¨æœ‰æœªä¿å­˜çš„æ—¥è®°å†…å®¹ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
            });
        });
    </script>
</body>
</html>